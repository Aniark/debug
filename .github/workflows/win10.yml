#某些老旧的bios可能不支持直接解压镜像到U盘安装，使用ventoy或rufus创建启动盘可解
name: win10
on: [workflow_dispatch]
jobs:
  create:
    runs-on: windows-2019
    env:
      TZ: Asia/Shanghai
    steps:
    - name: download
      shell: cmd
      run: |
        curl -OL https://uupdump.net/misc/uup-converter-wimlib-v120z.7z
        7z x uup-converter-wimlib-v120z.7z
        curl -OL https://uupdump.net/misc/aria2c.exe
        touch aria2_script.txt
        aria2c --no-conf --async-dns=false --console-log-level=warn --log-level=info --log="aria2_download.log" -oaria2_script.txt --allow-overwrite=true --auto-file-renaming=false "https://uupdump.net/get.php?id=3671e4cd-b7f1-4aa7-987a-ec2dbb82d0f3&pack=zh-cn&edition=professional&aria2=2"
        aria2c --no-conf --async-dns=false --console-log-level=warn --log-level=info --log="aria2_download.log" -x16 -s16 -j5 -c -R -dUUPs -iaria2_script.txt
    - name: sed
      shell: bash
      run: |
        sed -i 's/AutoStart    =0/AutoStart    =1/' ConvertConfig.ini
        sed -i 's/AddUpdates   =0/AddUpdates   =1/' ConvertConfig.ini
        sed -i 's/Cleanup      =0/Cleanup      =1/' ConvertConfig.ini
        sed -i 's/wim2esd      =0/wim2esd      =1/' ConvertConfig.ini
        sed -i 's/ResetBase    =0/ResetBase    =1/' ConvertConfig.ini
        sed -i 's/SkipEdge     =0/SkipEdge     =1/' ConvertConfig.ini
        sed -i 's/AutoExit     =0/AutoExit     =1/' ConvertConfig.ini
    - name: run
      shell: cmd
      run: |
        convert-UUP.cmd
    - name: 7z
      shell: cmd
      run: |
        FOR %%I IN (*.iso) DO 7z -tzip -mx0 a release/%%~nI.zip -v2000m %%~nI.*
    - name: release
      uses: softprops/action-gh-release@master
      with:
         tag_name: win10
         files: release/*
